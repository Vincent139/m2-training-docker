#!/usr/bin/env bash

cd $MAGENTO_SRC

# Composer install
composer install

composer require --dev "vpietri/adm-quickdevbar"

# uninstall in case of reinstall
bin/magento setup:uninstall -n

# play install
bin/magento setup:install \
  --base-url=$MAGENTO_URL \
  --backend-frontname=$MAGENTO_BO_NAME \
  --language=$MAGENTO_LANGUAGE \
  --timezone=$MAGENTO_TIMEZONE \
  --currency=$MAGENTO_DEFAULT_CURRENCY \
  --db-host=$MYSQL_HOST \
  --db-name=$MYSQL_DATABASE \
  --db-user=$MYSQL_USER \
  --db-password=$MYSQL_PASSWORD \
  --use-secure=$MAGENTO_USE_SECURE \
  --base-url-secure=$MAGENTO_URL_SECURE \
  --use-secure-admin=$MAGENTO_USE_SECURE_ADMIN \
  --admin-firstname=$MAGENTO_ADMIN_FIRSTNAME \
  --admin-lastname=$MAGENTO_ADMIN_LASTNAME \
  --admin-email=$MAGENTO_ADMIN_EMAIL \
  --admin-user=$MAGENTO_ADMIN_USERNAME \
  --admin-password=$MAGENTO_ADMIN_PASSWORD \
  --cleanup-database

bin/magento deploy:mode:set developer
bin/magento cache:clean
bin/magento setup:upgrade

bin/magento config:set --lock-env --scope=default --scope-code=0 web/secure/base_url https://admin.formation.m2.local/
bin/magento config:set --lock-env --scope=default --scope-code=0 web/unsecure/base_url https://admin.formation.m2.local/
bin/magento config:set --lock-env --scope=websites --scope-code=base web/secure/base_url https://formation.m2.local/
bin/magento config:set --lock-env --scope=websites --scope-code=base web/unsecure/base_url https://formation.m2.local/
